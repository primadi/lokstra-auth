@baseUrl = http://localhost:9090
@tenantId = demo-tenant
@appId = demo-app

### SCENARIO 1: Alice (Admin) - Full Access Demo
# ================================================

### 1.1 Alice Login
# @name aliceLogin
POST {{baseUrl}}/api/auth/cred/basic/login
Content-Type: application/json
X-Tenant-ID: {{tenantId}}
X-App-ID: {{appId}}

{
  "username": "alice",
  "password": "password123"
}

###

@aliceToken = {{aliceLogin.response.body.access_token}}

### 1.2 Alice - Access Protected Endpoint (Should work)
GET {{baseUrl}}/api/protected/info
Authorization: Bearer {{aliceToken}}
X-Tenant-ID: {{tenantId}}
X-App-ID: {{appId}}

###

### 1.3 Alice - Access Admin Dashboard (Should work - has admin role)
GET {{baseUrl}}/api/admin/dashboard
Authorization: Bearer {{aliceToken}}
X-Tenant-ID: {{tenantId}}
X-App-ID: {{appId}}

###

### 1.4 Alice - Read Document (Should work - has document:read permission)
GET {{baseUrl}}/api/documents/doc-123
Authorization: Bearer {{aliceToken}}
X-Tenant-ID: {{tenantId}}
X-App-ID: {{appId}}

###

### 1.5 Alice - Delete Document (Should work - has document:delete permission)
DELETE {{baseUrl}}/api/documents/doc-123
Authorization: Bearer {{aliceToken}}
X-Tenant-ID: {{tenantId}}
X-App-ID: {{appId}}

###

### SCENARIO 2: Bob (Editor) - Limited Access Demo
# =================================================

### 2.1 Bob Login
# @name bobLogin
POST {{baseUrl}}/api/auth/cred/basic/login
Content-Type: application/json
X-Tenant-ID: {{tenantId}}
X-App-ID: {{appId}}

{
  "username": "bob",
  "password": "password123"
}

###

@bobToken = {{bobLogin.response.body.access_token}}

### 2.2 Bob - Access Protected Endpoint (Should work)
GET {{baseUrl}}/api/protected/info
Authorization: Bearer {{bobToken}}
X-Tenant-ID: {{tenantId}}
X-App-ID: {{appId}}

###

### 2.3 Bob - Access Editor Content (Should work - has editor role)
GET {{baseUrl}}/api/editor/content
Authorization: Bearer {{bobToken}}
X-Tenant-ID: {{tenantId}}
X-App-ID: {{appId}}

###

### 2.4 Bob - Access Admin Dashboard (Should FAIL - no admin role)
GET {{baseUrl}}/api/admin/dashboard
Authorization: Bearer {{bobToken}}
X-Tenant-ID: {{tenantId}}
X-App-ID: {{appId}}

###

### 2.5 Bob - Write Document (Should work - has document:write permission)
POST {{baseUrl}}/api/documents/doc-456
Authorization: Bearer {{bobToken}}
X-Tenant-ID: {{tenantId}}
X-App-ID: {{appId}}
Content-Type: application/json

{
  "title": "My Document",
  "content": "Some content"
}

###

### 2.6 Bob - Delete Document (Should FAIL - no document:delete permission)
DELETE {{baseUrl}}/api/documents/doc-456
Authorization: Bearer {{bobToken}}
X-Tenant-ID: {{tenantId}}
X-App-ID: {{appId}}

###

### SCENARIO 3: Charlie (Viewer) - Read-Only Demo
# ================================================

### 3.1 Charlie Login
# @name charlieLogin
POST {{baseUrl}}/api/auth/cred/basic/login
Content-Type: application/json
X-Tenant-ID: {{tenantId}}
X-App-ID: {{appId}}

{
  "username": "charlie",
  "password": "password123"
}

###

@charlieToken = {{charlieLogin.response.body.access_token}}

### 3.2 Charlie - Access Protected Endpoint (Should work)
GET {{baseUrl}}/api/protected/info
Authorization: Bearer {{charlieToken}}
X-Tenant-ID: {{tenantId}}
X-App-ID: {{appId}}

###

### 3.3 Charlie - Access User Profile (Should work)
GET {{baseUrl}}/api/protected/profile
Authorization: Bearer {{charlieToken}}
X-Tenant-ID: {{tenantId}}
X-App-ID: {{appId}}

###

### 3.4 Charlie - Read Document (Should work - has document:read permission)
GET {{baseUrl}}/api/documents/doc-789
Authorization: Bearer {{charlieToken}}
X-Tenant-ID: {{tenantId}}
X-App-ID: {{appId}}

###

### 3.5 Charlie - Access Editor Content (Should FAIL - no editor role)
GET {{baseUrl}}/api/editor/content
Authorization: Bearer {{charlieToken}}
X-Tenant-ID: {{tenantId}}
X-App-ID: {{appId}}

###

### 3.6 Charlie - Write Document (Should FAIL - no document:write permission)
POST {{baseUrl}}/api/documents/doc-789
Authorization: Bearer {{charlieToken}}
X-Tenant-ID: {{tenantId}}
X-App-ID: {{appId}}
Content-Type: application/json

{
  "title": "My Document",
  "content": "Some content"
}

###

### 3.7 Charlie - Delete Document (Should FAIL - no document:delete permission)
DELETE {{baseUrl}}/api/documents/doc-789
Authorization: Bearer {{charlieToken}}
X-Tenant-ID: {{tenantId}}
X-App-ID: {{appId}}

###

### SCENARIO 4: Token Refresh Demo
# =================================

### 4.1 Refresh Alice's Token
# @name aliceRefresh
POST {{baseUrl}}/api/auth/cred/basic/refresh
Content-Type: application/json
X-Tenant-ID: {{tenantId}}
X-App-ID: {{appId}}

{
  "refresh_token": "{{aliceLogin.response.body.refresh_token}}"
}

###

@aliceNewToken = {{aliceRefresh.response.body.access_token}}

### 4.2 Use New Token
GET {{baseUrl}}/api/protected/profile
Authorization: Bearer {{aliceNewToken}}
X-Tenant-ID: {{tenantId}}
X-App-ID: {{appId}}

###

### SCENARIO 5: Error Cases
# ==========================

### 5.1 Access Protected Endpoint Without Token (Should FAIL - 401)
GET {{baseUrl}}/api/protected/info
X-Tenant-ID: {{tenantId}}
X-App-ID: {{appId}}

###

### 5.2 Access with Invalid Token (Should FAIL - 401)
GET {{baseUrl}}/api/protected/info
Authorization: Bearer invalid_token_here
X-Tenant-ID: {{tenantId}}
X-App-ID: {{appId}}

###

### 5.3 Login with Non-Existent User (Should FAIL)
POST {{baseUrl}}/api/auth/cred/basic/login
Content-Type: application/json
X-Tenant-ID: {{tenantId}}
X-App-ID: {{appId}}

{
  "username": "nonexistent",
  "password": "password123"
}

###
