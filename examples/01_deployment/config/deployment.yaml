# yaml-language-server: $schema=https://primadi.github.io/lokstra/schema/lokstra.schema.json

configs:
  server: ${SERVER:monolith.auth-server} # Deployment mode: monolith, microservices, development
  jwt:
    secret: ${JWT_SECRET:supersecretkeyyoushouldchange}
  email-service: ${EMAIL_SERVICE:email_smtp} 
  reset-password:
    subject: "Welcome to %s - Set Your Password"
    template: "Hello %s,\n\nWelcome to %s! Please set your password using the following link:\n\n%s\n\nBest regards,\nThe %s Team"
    
dbpool-definitions:
  db_auth:
    dsn: ${DB_AUTH_DSN:postgres://postgres:adm1n@localhost:5432/lokstra_db}
    schema: ${DB_AUTH_SCHEMA:lokstra_auth}
  db_main:
    dsn: ${DB_MAIN_DSN:postgres://postgres:adm1n@localhost:5432/lokstra_db}
    schema: ${DB_MAIN_SCHEMA:lokstra_auth}

# Deployment modes
deployments:
  # Monolith: All services run in one server
  monolith:
    servers:
      auth-server:
        base-url: "http://localhost"
        addr: ":9090"
        published-services:
          # core - Registration & Tenant Management
          - tenant-service
          - app-service
          - branch-service
          - user-service
          - app-key-service
          - credential-config-service

          # credential - Authentication
          - basic-auth-service
          # - apikey-auth-service
          # - oauth2-auth-service
          # - passwordless-auth-service
          # - passkey-auth-service

          # token - Token Management
          # - token-service

          # subject - Subject Resolution (future)
          # - subject-service

          # authz - Authorization (future)
          # - authz-service

  # Microservices: Separate servers per layer
  microservices:
    servers:
      # Core services (tenant, app, user management)
      core-server:
        base-url: "http://localhost"
        addr: ":8081"
        published-services:
          - tenant-service
          - app-service
          - branch-service
          - user-service
          - app-key-service
          - credential-config-service

      # Credential services (authentication)
      credential-server:
        base-url: "http://localhost"
        addr: ":8082"
        published-services:
          - basic-auth-service
          - apikey-auth-service
          - oauth2-auth-service
          - passwordless-auth-service
          - passkey-auth-service

      # Token services (future)
      # token-server:
      #   base-url: "http://localhost"
      #   addr: ":8083"
      #   published-services:
      #     - token-service

      # Subject services (future)
      # subject-server:
      #   base-url: "http://localhost"
      #   addr: ":8084"
      #   published-services:
      #     - subject-service

      # Authorization services (future)
      # authz-server:
      #   base-url: "http://localhost"
      #   addr: ":8085"
      #   published-services:
      #     - authz-service

  # Development: Monolith with debug settings
  development:
    servers:
      dev-server:
        base-url: "http://localhost"
        addr: ":3000"
        published-services:
          - tenant-service
          - app-service
          - branch-service
          - user-service
          - app-key-service
          - credential-config-service
          - basic-auth-service
          - apikey-auth-service
          - oauth2-auth-service
          - passwordless-auth-service
          - passkey-auth-service
